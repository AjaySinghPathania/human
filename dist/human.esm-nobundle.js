var Ve=Object.defineProperty;var y=(e,t)=>()=>(t||(t={exports:{}},e(t.exports,t)),t.exports),z0=e=>Ve(e,"__esModule",{value:!0}),Qe=(e,t)=>{z0(e);for(var n in t)Ve(e,n,{get:t[n],enumerable:!0})};var tt=y(ae=>{const g=require("@tensorflow/tfjs"),Ze=6;function N0(e){const t={strides:[e/16,e/8],anchors:[2,6]},n=[];for(let o=0;o<t.strides.length;o++){const i=t.strides[o],s=Math.floor((e+i-1)/i),r=Math.floor((e+i-1)/i),a=t.anchors[o];for(let c=0;c<s;c++){const d=i*(c+.5);for(let u=0;u<r;u++){const l=i*(u+.5);for(let h=0;h<a;h++)n.push([l,d])}}}return n}const $e=e=>{e.startEndTensor.dispose(),e.startPoint.dispose(),e.endPoint.dispose()},Je=e=>({startEndTensor:e,startPoint:g.slice(e,[0,0],[-1,2]),endPoint:g.slice(e,[0,2],[-1,2])}),A0=(e,t)=>{const n=g.mul(e.startPoint,t),o=g.mul(e.endPoint,t),i=g.concat2d([n,o],1);return Je(i)};function R0(e,t,n){const o=g.slice(e,[0,1],[-1,2]),i=g.add(o,t),s=g.slice(e,[0,3],[-1,2]),r=g.div(s,n),a=g.div(i,n),c=g.div(r,2),d=g.sub(a,c),u=g.add(a,c),l=g.mul(d,n),h=g.mul(u,n),m=1;return g.concat2d([l,h],m)}function O0(e,t){return g.tidy(()=>{const n=e.box?e.box:e;return A0(n,t).startEndTensor.squeeze()})}class et{constructor(e,t){this.blazeFaceModel=e,this.width=t.detector.inputSize,this.height=t.detector.inputSize,this.maxFaces=t.detector.maxFaces,this.anchorsData=N0(t.detector.inputSize),this.anchors=g.tensor2d(this.anchorsData),this.inputSize=g.tensor1d([this.width,this.height]),this.iouThreshold=t.detector.iouThreshold,this.scaleFaces=.8,this.scoreThreshold=t.detector.scoreThreshold}async getBoundingBoxes(e){if(!e||e.isDisposedInternal||e.shape.length!==4||e.shape[1]<1||e.shape[2]<1)return null;const[t,n,o]=g.tidy(()=>{const d=e.resizeBilinear([this.width,this.height]),u=g.mul(g.sub(d.div(255),.5),2),l=this.blazeFaceModel.predict(u);let h;if(Array.isArray(l)){const x=l.sort((C,F)=>C.size-F.size),M=g.concat([x[0],x[2]],2),w=g.concat([x[1],x[3]],2),A=g.concat([w,M],1);h=A.squeeze(0)}else h=l.squeeze();const m=R0(h,this.anchors,this.inputSize),p=g.slice(h,[0,0],[-1,1]),P=g.sigmoid(p).squeeze();return[h,m,P]}),i=await g.image.nonMaxSuppressionAsync(n,o,this.maxFaces,this.iouThreshold,this.scoreThreshold),s=await i.array();i.dispose();const r=s.map(d=>g.slice(n,[d,0],[1,-1])),a=await Promise.all(r.map(async d=>{const u=await d.array();return d.dispose(),u})),c=[];for(let d=0;d<a.length;d++){const u=a[d],l=Je(u),h=s[d],m=this.anchorsData[h],p=g.slice(t,[h,Ze-1],[1,-1]),P=p.squeeze(),x=P.reshape([Ze,-1]),M=g.slice(o,[h],[1]),w={box:l,landmarks:x,probability:M,anchor:m};c.push(w),p.dispose(),P.dispose()}return t.dispose(),n.dispose(),o.dispose(),t.dispose(),{boxes:c,scaleFactor:[e.shape[2]/this.width,e.shape[1]/this.height]}}async estimateFaces(e){const t=e instanceof g.Tensor?e:g.browser.fromPixels(e),n=t.toFloat(),o=n.expandDims(0);t.dispose(),n.dispose();const{boxes:i,scaleFactor:s}=await this.getBoundingBoxes(o);return o.dispose(),Promise.all(i.map(async r=>{const a=O0(r,s),[c,d,u]=await Promise.all([r.landmarks,a,r.probability].map(async x=>x.array())),l=r.anchor,[h,m]=s,p=c.map(x=>[(x[0]+l[0])*h,(x[1]+l[1])*m]),P={topLeft:d.slice(0,2),bottomRight:d.slice(2),landmarks:p,probability:u};return $e(r.box),r.landmarks.dispose(),r.probability.dispose(),a.dispose(),P}))}}async function v0(e){const t=await g.loadGraphModel(e.detector.modelPath,{fromTFHub:e.detector.modelPath.includes("tfhub.dev")}),n=new et(t,e);return n}ae.load=v0;ae.BlazeFaceModel=et;ae.disposeBox=$e});var ye=y(be=>{be.MESH_ANNOTATIONS={silhouette:[10,338,297,332,284,251,389,356,454,323,361,288,397,365,379,378,400,377,152,148,176,149,150,136,172,58,132,93,234,127,162,21,54,103,67,109],lipsUpperOuter:[61,185,40,39,37,0,267,269,270,409,291],lipsLowerOuter:[146,91,181,84,17,314,405,321,375,291],lipsUpperInner:[78,191,80,81,82,13,312,311,310,415,308],lipsLowerInner:[78,95,88,178,87,14,317,402,318,324,308],rightEyeUpper0:[246,161,160,159,158,157,173],rightEyeLower0:[33,7,163,144,145,153,154,155,133],rightEyeUpper1:[247,30,29,27,28,56,190],rightEyeLower1:[130,25,110,24,23,22,26,112,243],rightEyeUpper2:[113,225,224,223,222,221,189],rightEyeLower2:[226,31,228,229,230,231,232,233,244],rightEyeLower3:[143,111,117,118,119,120,121,128,245],rightEyebrowUpper:[156,70,63,105,66,107,55,193],rightEyebrowLower:[35,124,46,53,52,65],rightEyeIris:[473,474,475,476,477],leftEyeUpper0:[466,388,387,386,385,384,398],leftEyeLower0:[263,249,390,373,374,380,381,382,362],leftEyeUpper1:[467,260,259,257,258,286,414],leftEyeLower1:[359,255,339,254,253,252,256,341,463],leftEyeUpper2:[342,445,444,443,442,441,413],leftEyeLower2:[446,261,448,449,450,451,452,453,464],leftEyeLower3:[372,340,346,347,348,349,350,357,465],leftEyebrowUpper:[383,300,293,334,296,336,285,417],leftEyebrowLower:[265,353,276,283,282,295],leftEyeIris:[468,469,470,471,472],midwayBetweenEyes:[168],noseTip:[1],noseBottom:[2],noseRightCorner:[98],noseLeftCorner:[327],rightCheek:[205],leftCheek:[425]};be.MESH_TO_IRIS_INDICES_MAP=[{key:"EyeUpper0",indices:[9,10,11,12,13,14,15]},{key:"EyeUpper1",indices:[25,26,27,28,29,30,31]},{key:"EyeUpper2",indices:[41,42,43,44,45,46,47]},{key:"EyeLower0",indices:[0,1,2,3,4,5,6,7,8]},{key:"EyeLower1",indices:[16,17,18,19,20,21,22,23,24]},{key:"EyeLower2",indices:[32,33,34,35,36,37,38,39,40]},{key:"EyeLower3",indices:[54,55,56,57,58,59,60,61,62]},{key:"EyebrowUpper",indices:[63,64,65,66,67,68,69,70]},{key:"EyebrowLower",indices:[48,49,50,51,52,53]}]});var nt=y(G=>{const D0=require("@tensorflow/tfjs");function C0(e,t){const n=[e.startPoint[0]*t[0],e.startPoint[1]*t[1]],o=[e.endPoint[0]*t[0],e.endPoint[1]*t[1]];return{startPoint:n,endPoint:o}}G.scaleBoxCoordinates=C0;function xe(e){return[Math.abs(e.endPoint[0]-e.startPoint[0]),Math.abs(e.endPoint[1]-e.startPoint[1])]}G.getBoxSize=xe;function we(e){return[e.startPoint[0]+(e.endPoint[0]-e.startPoint[0])/2,e.startPoint[1]+(e.endPoint[1]-e.startPoint[1])/2]}G.getBoxCenter=we;function F0(e,t,n){const o=t.shape[1],i=t.shape[2],s=[[e.startPoint[1]/o,e.startPoint[0]/i,e.endPoint[1]/o,e.endPoint[0]/i]];return D0.image.cropAndResize(t,s,[0],n)}G.cutBoxFromImageAndResize=F0;function L0(e,t=1.5){const n=we(e),o=xe(e),i=[t*o[0]/2,t*o[1]/2],s=[n[0]-i[0],n[1]-i[1]],r=[n[0]+i[0],n[1]+i[1]];return{startPoint:s,endPoint:r,landmarks:e.landmarks}}G.enlargeBox=L0;function H0(e){const t=we(e),n=xe(e),o=Math.max(...n),i=o/2,s=[t[0]-i,t[1]-i],r=[t[0]+i,t[1]+i];return{startPoint:s,endPoint:r,landmarks:e.landmarks}}G.squarifyBox=H0});var at=y(_=>{_.IDENTITY_MATRIX=[[1,0,0],[0,1,0],[0,0,1]];function ot(e){return e-2*Math.PI*Math.floor((e+Math.PI)/(2*Math.PI))}_.normalizeRadians=ot;function q0(e,t){const n=Math.PI/2-Math.atan2(-(t[1]-e[1]),t[0]-e[0]);return ot(n)}_.computeRotation=q0;function j0(e){return e*180/Math.PI}_.radToDegrees=j0;function st(e,t){return[[1,0,e],[0,1,t],[0,0,1]]}function Q(e,t){let n=0;for(let o=0;o<e.length;o++)n+=e[o]*t[o];return n}_.dot=Q;function it(e,t){const n=[];for(let o=0;o<e.length;o++)n.push(e[o][t]);return n}_.getColumnFrom2DArr=it;function rt(e,t){const n=[],o=e.length;for(let i=0;i<o;i++){n.push([]);for(let s=0;s<o;s++)n[i].push(Q(e[i],it(t,s)))}return n}function U0(e,t){const n=Math.cos(e),o=Math.sin(e),i=[[n,-o,0],[o,n,0],[0,0,1]],s=st(t[0],t[1]),r=rt(s,i),a=st(-t[0],-t[1]);return rt(r,a)}_.buildRotationMatrix=U0;function W0(e){const t=[[e[0][0],e[1][0]],[e[0][1],e[1][1]]],n=[e[0][2],e[1][2]],o=[-Q(t[0],n),-Q(t[1],n)];return[t[0].concat(o[0]),t[1].concat(o[1]),[0,0,1]]}_.invertTransformMatrix=W0;function K0(e,t){return[Q(e,t[0]),Q(e,t[1])]}_.rotatePoint=K0;function Y0(e,t){return Math.sqrt((e[0]-t[0])**2+(e[1]-t[1])**2)}_.xyDistanceBetweenPoints=Y0});var dt=y(ct=>{const D=require("@tensorflow/tfjs"),R=nt(),L=ye(),H=at(),X0=468,G0=.25,V0=13,Q0=[V0,L.MESH_ANNOTATIONS.midwayBetweenEyes[0]],Z0=3,$0=2,J0=[Z0,$0],Pe=L.MESH_ANNOTATIONS.leftEyeLower0,Me=[Pe[0],Pe[Pe.length-1]],Ee=L.MESH_ANNOTATIONS.rightEyeLower0,Ie=[Ee[0],Ee[Ee.length-1]],en=3,tn=4,nn=71,Se=76;function ce(e,t,n,o){for(let i=0;i<L.MESH_TO_IRIS_INDICES_MAP.length;i++){const{key:s,indices:r}=L.MESH_TO_IRIS_INDICES_MAP[i],a=L.MESH_ANNOTATIONS[`${n}${s}`],c=o==null;if(c||o.includes(s))for(let d=0;d<r.length;d++){const u=r[d];e[a[d]]=[t[u][0],t[u][1],(t[u][2]+e[a[d]][2])/2]}}}class on{constructor(e,t,n,o){this.regionsOfInterest=[],this.runsWithoutFaceDetector=0,this.boundingBoxDetector=e,this.meshDetector=t,this.irisModel=n,this.meshWidth=o.mesh.inputSize,this.meshHeight=o.mesh.inputSize,this.irisSize=o.iris.inputSize,this.irisEnlarge=o.iris.enlargeFactor}transformRawCoords(e,t,n,o){const i=R.getBoxSize({startPoint:t.startPoint,endPoint:t.endPoint}),s=[i[0]/this.meshWidth,i[1]/this.meshHeight],r=e.map(h=>[s[0]*(h[0]-this.meshWidth/2),s[1]*(h[1]-this.meshHeight/2),h[2]]),a=H.buildRotationMatrix(n,[0,0]),c=r.map(h=>[...H.rotatePoint(h,a),h[2]]),d=H.invertTransformMatrix(o),u=[...R.getBoxCenter({startPoint:t.startPoint,endPoint:t.endPoint}),1],l=[H.dot(u,d[0]),H.dot(u,d[1])];return c.map(h=>[h[0]+l[0],h[1]+l[1],h[2]])}getLeftToRightEyeDepthDifference(e){const t=e[Me[0]][2],n=e[Ie[0]][2];return t-n}getEyeBox(e,t,n,o,i=!1){const s=R.squarifyBox(R.enlargeBox(this.calculateLandmarksBoundingBox([e[n],e[o]]),this.irisEnlarge)),r=R.getBoxSize(s);let a=D.image.cropAndResize(t,[[s.startPoint[1]/this.meshHeight,s.startPoint[0]/this.meshWidth,s.endPoint[1]/this.meshHeight,s.endPoint[0]/this.meshWidth]],[0],[this.irisSize,this.irisSize]);return i&&(a=D.image.flipLeftRight(a)),{box:s,boxSize:r,crop:a}}getEyeCoords(e,t,n,o=!1){const i=[];for(let s=0;s<Se;s++){const r=e[s*3],a=e[s*3+1],c=e[s*3+2];i.push([(o?1-r/this.irisSize:r/this.irisSize)*n[0]+t.startPoint[0],a/this.irisSize*n[1]+t.startPoint[1],c])}return{rawCoords:i,iris:i.slice(nn)}}getAdjustedIrisCoords(e,t,n){const o=e[L.MESH_ANNOTATIONS[`${n}EyeUpper0`][en]][2],i=e[L.MESH_ANNOTATIONS[`${n}EyeLower0`][tn]][2],s=(o+i)/2;return t.map((r,a)=>{let c=s;return a===2?c=o:a===4&&(c=i),[r[0],r[1],c]})}async predict(e,t){if(this.skipFrames=t.detector.skipFrames,this.maxFaces=t.detector.maxFaces,this.shouldUpdateRegionsOfInterest()){const o=await this.boundingBoxDetector.getBoundingBoxes(e);if(o.boxes.length===0)return this.regionsOfInterest=[],null;const i=o.boxes.map(s=>{const r=s.box.startPoint.squeeze(),a=s.box.endPoint.squeeze(),c={startPoint:r.arraySync(),endPoint:a.arraySync()};r.dispose(),a.dispose();const d=R.scaleBoxCoordinates(c,o.scaleFactor),u=R.enlargeBox(d),l=s.landmarks.arraySync();return s.box.startPoint.dispose(),s.box.endPoint.dispose(),s.landmarks.dispose(),s.probability.dispose(),{...u,landmarks:l}});this.updateRegionsOfInterest(i),this.runsWithoutFaceDetector=0}else this.runsWithoutFaceDetector++;const n=D.tidy(()=>this.regionsOfInterest.map((o,i)=>{let s=0;const r=o.landmarks.length>=X0;let[a,c]=Q0;r===!1&&([a,c]=J0),s=H.computeRotation(o.landmarks[a],o.landmarks[c]);const d=R.getBoxCenter({startPoint:o.startPoint,endPoint:o.endPoint}),u=[d[0]/e.shape[2],d[1]/e.shape[1]];let l=e,h=H.IDENTITY_MATRIX;s!==0&&(l=D.image.rotateWithOffset(e,s,0,u),h=H.buildRotationMatrix(-s,d));const m={startPoint:o.startPoint,endPoint:o.endPoint},p=R.cutBoxFromImageAndResize(m,l,[this.meshHeight,this.meshWidth]).div(255),[,P,x]=this.meshDetector.predict(p),M=D.reshape(x,[-1,3]);let w=M.arraySync();if(t.iris.enabled){const{box:re,boxSize:ge,crop:w0}=this.getEyeBox(w,p,Me[0],Me[1],!0),{box:P0,boxSize:M0,crop:E0}=this.getEyeBox(w,p,Ie[0],Ie[1]),We=this.irisModel.predict(D.concat([w0,E0])),Ke=We.dataSync();We.dispose();const I0=Ke.slice(0,Se*3),{rawCoords:Ye,iris:S0}=this.getEyeCoords(I0,re,ge,!0),B0=Ke.slice(Se*3),{rawCoords:Xe,iris:T0}=this.getEyeCoords(B0,P0,M0),Ge=this.getLeftToRightEyeDepthDifference(w);Math.abs(Ge)<30?(ce(w,Ye,"left"),ce(w,Xe,"right")):Ge<1?ce(w,Ye,"left",["EyeUpper0","EyeLower0"]):ce(w,Xe,"right",["EyeUpper0","EyeLower0"]);const k0=this.getAdjustedIrisCoords(w,S0,"left"),_0=this.getAdjustedIrisCoords(w,T0,"right");w=w.concat(k0).concat(_0)}const A=this.transformRawCoords(w,o,s,h);D.dispose(w);const C=R.enlargeBox(this.calculateLandmarksBoundingBox(A)),F=P.squeeze();if(D.dispose(P),t.mesh.enabled){const re=D.tensor2d(A);this.regionsOfInterest[i]={...C,landmarks:re.arraySync()};const ge={coords:re,box:C,confidence:F,image:p};return ge}const fe={coords:null,box:C,confidence:F,image:p};return fe}));return n}updateRegionsOfInterest(e){for(let t=0;t<e.length;t++){const n=e[t],o=this.regionsOfInterest[t];let i=0;if(o&&o.startPoint){const[s,r]=n.startPoint,[a,c]=n.endPoint,[d,u]=o.startPoint,[l,h]=o.endPoint,m=Math.max(s,d),p=Math.max(r,u),P=Math.min(a,l),x=Math.min(c,h),M=(P-m)*(x-p),w=(a-s)*(c-r),A=(l-d)*(h-r);i=M/(w+A-M)}i<G0&&(this.regionsOfInterest[t]=n)}this.regionsOfInterest=this.regionsOfInterest.slice(0,e.length)}clearRegionOfInterest(e){this.regionsOfInterest[e]!=null&&(this.regionsOfInterest=[...this.regionsOfInterest.slice(0,e),...this.regionsOfInterest.slice(e+1)])}shouldUpdateRegionsOfInterest(){const e=this.regionsOfInterest.length,t=e===0;return this.maxFaces===1||t?t:e!==this.maxFaces&&this.runsWithoutFaceDetector>=this.skipFrames}calculateLandmarksBoundingBox(e){const t=e.map(s=>s[0]),n=e.map(s=>s[1]),o=[Math.min(...t),Math.min(...n)],i=[Math.max(...t),Math.max(...n)];return{startPoint:o,endPoint:i,landmarks:e}}}ct.Pipeline=on});var ht=y(lt=>{lt.UV_COORDS=[[.499976992607117,.652534008026123],[.500025987625122,.547487020492554],[.499974012374878,.602371990680695],[.482113003730774,.471979022026062],[.500150978565216,.527155995368958],[.499909996986389,.498252987861633],[.499523013830185,.40106201171875],[.289712011814117,.380764007568359],[.499954998493195,.312398016452789],[.499987006187439,.269918978214264],[.500023007392883,.107050001621246],[.500023007392883,.666234016418457],[.5000159740448,.679224014282227],[.500023007392883,.692348003387451],[.499976992607117,.695277988910675],[.499976992607117,.70593398809433],[.499976992607117,.719385027885437],[.499976992607117,.737019002437592],[.499967992305756,.781370997428894],[.499816000461578,.562981009483337],[.473773002624512,.573909997940063],[.104906998574734,.254140973091125],[.365929991006851,.409575998783112],[.338757991790771,.41302502155304],[.311120003461838,.409460008144379],[.274657994508743,.389131009578705],[.393361985683441,.403706014156342],[.345234006643295,.344011008739471],[.370094001293182,.346076011657715],[.319321990013123,.347265005111694],[.297903001308441,.353591024875641],[.24779200553894,.410809993743896],[.396889001131058,.842755019664764],[.280097991228104,.375599980354309],[.106310002505779,.399955987930298],[.2099249958992,.391353011131287],[.355807989835739,.534406006336212],[.471751004457474,.65040397644043],[.474155008792877,.680191993713379],[.439785003662109,.657229006290436],[.414617002010345,.66654098033905],[.450374007225037,.680860996246338],[.428770989179611,.682690978050232],[.374971002340317,.727805018424988],[.486716985702515,.547628998756409],[.485300987958908,.527395009994507],[.257764995098114,.314490020275116],[.401223003864288,.455172002315521],[.429818987846375,.548614978790283],[.421351999044418,.533740997314453],[.276895999908447,.532056987285614],[.483370006084442,.499586999416351],[.33721199631691,.282882988452911],[.296391993761063,.293242990970612],[.169294998049736,.193813979625702],[.447580009698868,.302609980106354],[.392390012741089,.353887975215912],[.354490011930466,.696784019470215],[.067304998636246,.730105042457581],[.442739009857178,.572826027870178],[.457098007202148,.584792017936707],[.381974011659622,.694710969924927],[.392388999462128,.694203019142151],[.277076005935669,.271932005882263],[.422551989555359,.563233017921448],[.385919004678726,.281364023685455],[.383103013038635,.255840003490448],[.331431001424789,.119714021682739],[.229923993349075,.232002973556519],[.364500999450684,.189113974571228],[.229622006416321,.299540996551514],[.173287004232407,.278747975826263],[.472878992557526,.666198015213013],[.446828007698059,.668527007102966],[.422762006521225,.673889994621277],[.445307999849319,.580065965652466],[.388103008270264,.693961024284363],[.403039008378983,.706539988517761],[.403629004955292,.693953037261963],[.460041999816895,.557139039039612],[.431158006191254,.692366003990173],[.452181994915009,.692366003990173],[.475387006998062,.692366003990173],[.465828001499176,.779190003871918],[.472328990697861,.736225962638855],[.473087012767792,.717857003211975],[.473122000694275,.704625964164734],[.473033010959625,.695277988910675],[.427942007780075,.695277988910675],[.426479011774063,.703539967536926],[.423162013292313,.711845993995667],[.4183090031147,.720062971115112],[.390094995498657,.639572978019714],[.013953999616206,.560034036636353],[.499913990497589,.58014702796936],[.413199990987778,.69539999961853],[.409626007080078,.701822996139526],[.468080013990402,.601534962654114],[.422728985548019,.585985004901886],[.463079988956451,.593783974647522],[.37211999297142,.47341400384903],[.334562003612518,.496073007583618],[.411671012639999,.546965003013611],[.242175996303558,.14767599105835],[.290776997804642,.201445996761322],[.327338010072708,.256527006626129],[.399509996175766,.748921036720276],[.441727995872498,.261676013469696],[.429764986038208,.187834024429321],[.412198007106781,.108901023864746],[.288955003023148,.398952007293701],[.218936994671822,.435410976409912],[.41278201341629,.398970007896423],[.257135003805161,.355440020561218],[.427684992551804,.437960982322693],[.448339998722076,.536936044692993],[.178560003638268,.45755398273468],[.247308000922203,.457193970680237],[.286267012357712,.467674970626831],[.332827985286713,.460712015628815],[.368755996227264,.447206974029541],[.398963987827301,.432654976844788],[.476410001516342,.405806005001068],[.189241006970406,.523923993110657],[.228962004184723,.348950982093811],[.490725994110107,.562400996685028],[.404670000076294,.485132992267609],[.019469000399113,.401564002037048],[.426243007183075,.420431017875671],[.396993011236191,.548797011375427],[.266469985246658,.376977026462555],[.439121007919312,.51895797252655],[.032313998788595,.644356966018677],[.419054001569748,.387154996395111],[.462783008813858,.505746960639954],[.238978996872902,.779744982719421],[.198220998048782,.831938028335571],[.107550002634525,.540755033493042],[.183610007166862,.740257024765015],[.134409993886948,.333683013916016],[.385764002799988,.883153975009918],[.490967005491257,.579378008842468],[.382384985685349,.508572995662689],[.174399003386497,.397670984268188],[.318785011768341,.39623498916626],[.343364000320435,.400596976280212],[.396100014448166,.710216999053955],[.187885001301765,.588537991046906],[.430987000465393,.944064974784851],[.318993002176285,.898285031318665],[.266247987747192,.869701027870178],[.500023007392883,.190576016902924],[.499976992607117,.954452991485596],[.366169989109039,.398822009563446],[.393207013607025,.39553701877594],[.410373002290726,.391080021858215],[.194993004202843,.342101991176605],[.388664990663528,.362284004688263],[.365961998701096,.355970978736877],[.343364000320435,.355356991291046],[.318785011768341,.35834002494812],[.301414996385574,.363156020641327],[.058132998645306,.319076001644135],[.301414996385574,.387449026107788],[.499987989664078,.618434011936188],[.415838003158569,.624195992946625],[.445681989192963,.566076993942261],[.465844005346298,.620640993118286],[.49992299079895,.351523995399475],[.288718998432159,.819945991039276],[.335278987884521,.852819979190826],[.440512001514435,.902418971061707],[.128294005990028,.791940987110138],[.408771991729736,.373893976211548],[.455606997013092,.451801002025604],[.499877005815506,.908990025520325],[.375436991453171,.924192011356354],[.11421000212431,.615022003650665],[.448662012815475,.695277988910675],[.4480200111866,.704632043838501],[.447111994028091,.715808033943176],[.444831997156143,.730794012546539],[.430011987686157,.766808986663818],[.406787008047104,.685672998428345],[.400738000869751,.681069016456604],[.392399996519089,.677703022956848],[.367855995893478,.663918972015381],[.247923001646996,.601333022117615],[.452769994735718,.420849978923798],[.43639200925827,.359887003898621],[.416164010763168,.368713974952698],[.413385987281799,.692366003990173],[.228018000721931,.683571994304657],[.468268007040024,.352671027183533],[.411361992359161,.804327011108398],[.499989002943039,.469825029373169],[.479153990745544,.442654013633728],[.499974012374878,.439637005329132],[.432112008333206,.493588984012604],[.499886006116867,.866917014122009],[.49991300702095,.821729004383087],[.456548988819122,.819200992584229],[.344549000263214,.745438992977142],[.37890899181366,.574010014533997],[.374292999505997,.780184984207153],[.319687992334366,.570737957954407],[.357154995203018,.604269981384277],[.295284003019333,.621580958366394],[.447750002145767,.862477004528046],[.410986006259918,.508723020553589],[.31395098567009,.775308012962341],[.354128003120422,.812552988529205],[.324548006057739,.703992962837219],[.189096003770828,.646299958229065],[.279776990413666,.71465802192688],[.1338230073452,.682700991630554],[.336768001317978,.644733011722565],[.429883986711502,.466521978378296],[.455527991056442,.548622965812683],[.437114000320435,.558896005153656],[.467287987470627,.529924988746643],[.414712011814117,.335219979286194],[.37704598903656,.322777986526489],[.344107985496521,.320150971412659],[.312875986099243,.32233202457428],[.283526003360748,.333190023899078],[.241245999932289,.382785975933075],[.102986000478268,.468762993812561],[.267612010240555,.424560010433197],[.297879010438919,.433175981044769],[.333433985710144,.433878004550934],[.366427004337311,.426115989685059],[.396012008190155,.416696012020111],[.420121014118195,.41022801399231],[.007561000064015,.480777025222778],[.432949006557465,.569517970085144],[.458638995885849,.479089021682739],[.473466008901596,.545744001865387],[.476087987422943,.563830018043518],[.468472003936768,.555056989192963],[.433990985155106,.582361996173859],[.483518004417419,.562983989715576],[.482482999563217,.57784903049469],[.42645001411438,.389798998832703],[.438998997211456,.39649498462677],[.450067013502121,.400434017181396],[.289712011814117,.368252992630005],[.276670008897781,.363372981548309],[.517862021923065,.471948027610779],[.710287988185883,.380764007568359],[.526226997375488,.573909997940063],[.895093023777008,.254140973091125],[.634069979190826,.409575998783112],[.661242008209229,.41302502155304],[.688880026340485,.409460008144379],[.725341975688934,.389131009578705],[.606630027294159,.40370500087738],[.654766023159027,.344011008739471],[.629905998706818,.346076011657715],[.680678009986877,.347265005111694],[.702096998691559,.353591024875641],[.75221198797226,.410804986953735],[.602918028831482,.842862963676453],[.719901978969574,.375599980354309],[.893692970275879,.399959981441498],[.790081977844238,.391354024410248],[.643998026847839,.534487962722778],[.528249025344849,.65040397644043],[.525849997997284,.680191040039062],[.560214996337891,.657229006290436],[.585384011268616,.66654098033905],[.549625992774963,.680860996246338],[.57122802734375,.682691991329193],[.624852001667023,.72809898853302],[.513050019741058,.547281980514526],[.51509702205658,.527251958847046],[.742246985435486,.314507007598877],[.598631024360657,.454979002475739],[.570338010787964,.548575043678284],[.578631997108459,.533622980117798],[.723087012767792,.532054007053375],[.516445994377136,.499638974666595],[.662801027297974,.282917976379395],[.70362401008606,.293271005153656],[.830704987049103,.193813979625702],[.552385985851288,.302568018436432],[.607609987258911,.353887975215912],[.645429015159607,.696707010269165],[.932694971561432,.730105042457581],[.557260990142822,.572826027870178],[.542901992797852,.584792017936707],[.6180260181427,.694710969924927],[.607590973377228,.694203019142151],[.722943007946014,.271963000297546],[.577413976192474,.563166975975037],[.614082992076874,.281386971473694],[.616907000541687,.255886018276215],[.668509006500244,.119913995265961],[.770092010498047,.232020974159241],[.635536015033722,.189248979091644],[.77039098739624,.299556016921997],[.826722025871277,.278755009174347],[.527121007442474,.666198015213013],[.553171992301941,.668527007102966],[.577238023281097,.673889994621277],[.554691970348358,.580065965652466],[.611896991729736,.693961024284363],[.59696102142334,.706539988517761],[.596370995044708,.693953037261963],[.539958000183105,.557139039039612],[.568841993808746,.692366003990173],[.547818005084991,.692366003990173],[.52461302280426,.692366003990173],[.534089982509613,.779141008853912],[.527670979499817,.736225962638855],[.526912987232208,.717857003211975],[.526877999305725,.704625964164734],[.526966989040375,.695277988910675],[.572058022022247,.695277988910675],[.573521018028259,.703539967536926],[.57683801651001,.711845993995667],[.581691026687622,.720062971115112],[.609944999217987,.639909982681274],[.986046016216278,.560034036636353],[.5867999792099,.69539999961853],[.590372025966644,.701822996139526],[.531915009021759,.601536989212036],[.577268004417419,.585934996604919],[.536915004253387,.593786001205444],[.627542972564697,.473352015018463],[.665585994720459,.495950996875763],[.588353991508484,.546862006187439],[.757824003696442,.14767599105835],[.709249973297119,.201507985591888],[.672684013843536,.256581008434296],[.600408971309662,.74900496006012],[.55826598405838,.261672019958496],[.570303976535797,.187870979309082],[.588165998458862,.109044015407562],[.711045026779175,.398952007293701],[.781069993972778,.435405015945435],[.587247014045715,.398931980133057],[.742869973182678,.355445981025696],[.572156012058258,.437651991844177],[.55186802148819,.536570012569427],[.821442008018494,.457556009292603],[.752701997756958,.457181990146637],[.71375697851181,.467626988887787],[.66711300611496,.460672974586487],[.631101012229919,.447153985500336],[.6008620262146,.432473003864288],[.523481011390686,.405627012252808],[.810747981071472,.523926019668579],[.771045982837677,.348959028720856],[.509127020835876,.562718033790588],[.595292985439301,.485023975372314],[.980530977249146,.401564002037048],[.573499977588654,.420000016689301],[.602994978427887,.548687994480133],[.733529984951019,.376977026462555],[.560611009597778,.519016981124878],[.967685997486115,.644356966018677],[.580985009670258,.387160003185272],[.537728011608124,.505385041236877],[.760966002941132,.779752969741821],[.801778972148895,.831938028335571],[.892440974712372,.54076099395752],[.816350996494293,.740260004997253],[.865594983100891,.333687007427216],[.614073991775513,.883246004581451],[.508952975273132,.579437971115112],[.617941975593567,.508316040039062],[.825608015060425,.397674977779388],[.681214988231659,.39623498916626],[.656635999679565,.400596976280212],[.603900015354156,.710216999053955],[.81208598613739,.588539004325867],[.56801301240921,.944564998149872],[.681007981300354,.898285031318665],[.733752012252808,.869701027870178],[.633830010890961,.398822009563446],[.606792986392975,.39553701877594],[.589659988880157,.391062021255493],[.805015981197357,.342108011245728],[.611334979534149,.362284004688263],[.634037971496582,.355970978736877],[.656635999679565,.355356991291046],[.681214988231659,.35834002494812],[.698584973812103,.363156020641327],[.941866993904114,.319076001644135],[.698584973812103,.387449026107788],[.584177017211914,.624107003211975],[.554318010807037,.566076993942261],[.534153997898102,.62064003944397],[.711217999458313,.819975018501282],[.664629995822906,.852871000766754],[.559099972248077,.902631998062134],[.871706008911133,.791940987110138],[.591234028339386,.373893976211548],[.544341027736664,.451583981513977],[.624562978744507,.924192011356354],[.88577002286911,.615028977394104],[.551338016986847,.695277988910675],[.551980018615723,.704632043838501],[.552887976169586,.715808033943176],[.555167973041534,.730794012546539],[.569944024085999,.767035007476807],[.593203008174896,.685675978660583],[.599261999130249,.681069016456604],[.607599973678589,.677703022956848],[.631937980651855,.663500010967255],[.752032995223999,.601315021514893],[.547226011753082,.420395016670227],[.563543975353241,.359827995300293],[.583841025829315,.368713974952698],[.586614012718201,.692366003990173],[.771915018558502,.683578014373779],[.531597018241882,.352482974529266],[.588370978832245,.804440975189209],[.52079701423645,.442565023899078],[.567984998226166,.493479013442993],[.543282985687256,.819254994392395],[.655317008495331,.745514988899231],[.621008992195129,.574018001556396],[.625559985637665,.78031200170517],[.680198013782501,.570719003677368],[.64276397228241,.604337990283966],[.704662978649139,.621529996395111],[.552012026309967,.862591981887817],[.589071989059448,.508637011051178],[.685944974422455,.775357007980347],[.645735025405884,.812640011310577],[.675342977046967,.703978002071381],[.810858011245728,.646304965019226],[.72012197971344,.714666962623596],[.866151988506317,.682704985141754],[.663187026977539,.644596993923187],[.570082008838654,.466325998306274],[.544561982154846,.548375964164734],[.562758982181549,.558784961700439],[.531987011432648,.530140042304993],[.585271000862122,.335177004337311],[.622952997684479,.32277899980545],[.655896008014679,.320163011550903],[.687132000923157,.322345972061157],[.716481983661652,.333200991153717],[.758756995201111,.382786989212036],[.897013008594513,.468769013881683],[.732392013072968,.424547016620636],[.70211398601532,.433162987232208],[.66652500629425,.433866024017334],[.633504986763,.426087975502014],[.603875994682312,.416586995124817],[.579657971858978,.409945011138916],[.992439985275269,.480777025222778],[.567192018032074,.569419980049133],[.54136598110199,.478899002075195],[.526564002037048,.546118021011353],[.523913025856018,.563830018043518],[.531529009342194,.555056989192963],[.566035985946655,.582329034805298],[.51631098985672,.563053965568542],[.5174720287323,.577877044677734],[.573594987392426,.389806985855103],[.560697972774506,.395331978797913],[.549755990505219,.399751007556915],[.710287988185883,.368252992630005],[.723330020904541,.363372981548309]]});var ut=y(sn=>{Qe(sn,{default:()=>rn});var rn=[127,34,139,11,0,37,232,231,120,72,37,39,128,121,47,232,121,128,104,69,67,175,171,148,157,154,155,118,50,101,73,39,40,9,151,108,48,115,131,194,204,211,74,40,185,80,42,183,40,92,186,230,229,118,202,212,214,83,18,17,76,61,146,160,29,30,56,157,173,106,204,194,135,214,192,203,165,98,21,71,68,51,45,4,144,24,23,77,146,91,205,50,187,201,200,18,91,106,182,90,91,181,85,84,17,206,203,36,148,171,140,92,40,39,193,189,244,159,158,28,247,246,161,236,3,196,54,68,104,193,168,8,117,228,31,189,193,55,98,97,99,126,47,100,166,79,218,155,154,26,209,49,131,135,136,150,47,126,217,223,52,53,45,51,134,211,170,140,67,69,108,43,106,91,230,119,120,226,130,247,63,53,52,238,20,242,46,70,156,78,62,96,46,53,63,143,34,227,173,155,133,123,117,111,44,125,19,236,134,51,216,206,205,154,153,22,39,37,167,200,201,208,36,142,100,57,212,202,20,60,99,28,158,157,35,226,113,160,159,27,204,202,210,113,225,46,43,202,204,62,76,77,137,123,116,41,38,72,203,129,142,64,98,240,49,102,64,41,73,74,212,216,207,42,74,184,169,170,211,170,149,176,105,66,69,122,6,168,123,147,187,96,77,90,65,55,107,89,90,180,101,100,120,63,105,104,93,137,227,15,86,85,129,102,49,14,87,86,55,8,9,100,47,121,145,23,22,88,89,179,6,122,196,88,95,96,138,172,136,215,58,172,115,48,219,42,80,81,195,3,51,43,146,61,171,175,199,81,82,38,53,46,225,144,163,110,246,33,7,52,65,66,229,228,117,34,127,234,107,108,69,109,108,151,48,64,235,62,78,191,129,209,126,111,35,143,163,161,246,117,123,50,222,65,52,19,125,141,221,55,65,3,195,197,25,7,33,220,237,44,70,71,139,122,193,245,247,130,33,71,21,162,153,158,159,170,169,150,188,174,196,216,186,92,144,160,161,2,97,167,141,125,241,164,167,37,72,38,12,145,159,160,38,82,13,63,68,71,226,35,111,158,153,154,101,50,205,206,92,165,209,198,217,165,167,97,220,115,218,133,112,243,239,238,241,214,135,169,190,173,133,171,208,32,125,44,237,86,87,178,85,86,179,84,85,180,83,84,181,201,83,182,137,93,132,76,62,183,61,76,184,57,61,185,212,57,186,214,207,187,34,143,156,79,239,237,123,137,177,44,1,4,201,194,32,64,102,129,213,215,138,59,166,219,242,99,97,2,94,141,75,59,235,24,110,228,25,130,226,23,24,229,22,23,230,26,22,231,112,26,232,189,190,243,221,56,190,28,56,221,27,28,222,29,27,223,30,29,224,247,30,225,238,79,20,166,59,75,60,75,240,147,177,215,20,79,166,187,147,213,112,233,244,233,128,245,128,114,188,114,217,174,131,115,220,217,198,236,198,131,134,177,132,58,143,35,124,110,163,7,228,110,25,356,389,368,11,302,267,452,350,349,302,303,269,357,343,277,452,453,357,333,332,297,175,152,377,384,398,382,347,348,330,303,304,270,9,336,337,278,279,360,418,262,431,304,408,409,310,415,407,270,409,410,450,348,347,422,430,434,313,314,17,306,307,375,387,388,260,286,414,398,335,406,418,364,367,416,423,358,327,251,284,298,281,5,4,373,374,253,307,320,321,425,427,411,421,313,18,321,405,406,320,404,405,315,16,17,426,425,266,377,400,369,322,391,269,417,465,464,386,257,258,466,260,388,456,399,419,284,332,333,417,285,8,346,340,261,413,441,285,327,460,328,355,371,329,392,439,438,382,341,256,429,420,360,364,394,379,277,343,437,443,444,283,275,440,363,431,262,369,297,338,337,273,375,321,450,451,349,446,342,467,293,334,282,458,461,462,276,353,383,308,324,325,276,300,293,372,345,447,382,398,362,352,345,340,274,1,19,456,248,281,436,427,425,381,256,252,269,391,393,200,199,428,266,330,329,287,273,422,250,462,328,258,286,384,265,353,342,387,259,257,424,431,430,342,353,276,273,335,424,292,325,307,366,447,345,271,303,302,423,266,371,294,455,460,279,278,294,271,272,304,432,434,427,272,407,408,394,430,431,395,369,400,334,333,299,351,417,168,352,280,411,325,319,320,295,296,336,319,403,404,330,348,349,293,298,333,323,454,447,15,16,315,358,429,279,14,15,316,285,336,9,329,349,350,374,380,252,318,402,403,6,197,419,318,319,325,367,364,365,435,367,397,344,438,439,272,271,311,195,5,281,273,287,291,396,428,199,311,271,268,283,444,445,373,254,339,263,466,249,282,334,296,449,347,346,264,447,454,336,296,299,338,10,151,278,439,455,292,407,415,358,371,355,340,345,372,390,249,466,346,347,280,442,443,282,19,94,370,441,442,295,248,419,197,263,255,359,440,275,274,300,383,368,351,412,465,263,467,466,301,368,389,380,374,386,395,378,379,412,351,419,436,426,322,373,390,388,2,164,393,370,462,461,164,0,267,302,11,12,374,373,387,268,12,13,293,300,301,446,261,340,385,384,381,330,266,425,426,423,391,429,355,437,391,327,326,440,457,438,341,382,362,459,457,461,434,430,394,414,463,362,396,369,262,354,461,457,316,403,402,315,404,403,314,405,404,313,406,405,421,418,406,366,401,361,306,408,407,291,409,408,287,410,409,432,436,410,434,416,411,264,368,383,309,438,457,352,376,401,274,275,4,421,428,262,294,327,358,433,416,367,289,455,439,462,370,326,2,326,370,305,460,455,254,449,448,255,261,446,253,450,449,252,451,450,256,452,451,341,453,452,413,464,463,441,413,414,258,442,441,257,443,442,259,444,443,260,445,444,467,342,445,459,458,250,289,392,290,290,328,460,376,433,435,250,290,392,411,416,433,341,463,464,453,464,465,357,465,412,343,412,399,360,363,440,437,399,456,420,456,363,401,435,288,372,383,353,339,255,249,448,261,255,133,243,190,133,155,112,33,246,247,33,130,25,398,384,286,362,398,414,362,463,341,263,359,467,263,249,255,466,467,260,75,60,166,238,239,79,162,127,139,72,11,37,121,232,120,73,72,39,114,128,47,233,232,128,103,104,67,152,175,148,173,157,155,119,118,101,74,73,40,107,9,108,49,48,131,32,194,211,184,74,185,191,80,183,185,40,186,119,230,118,210,202,214,84,83,17,77,76,146,161,160,30,190,56,173,182,106,194,138,135,192,129,203,98,54,21,68,5,51,4,145,144,23,90,77,91,207,205,187,83,201,18,181,91,182,180,90,181,16,85,17,205,206,36,176,148,140,165,92,39,245,193,244,27,159,28,30,247,161,174,236,196,103,54,104,55,193,8,111,117,31,221,189,55,240,98,99,142,126,100,219,166,218,112,155,26,198,209,131,169,135,150,114,47,217,224,223,53,220,45,134,32,211,140,109,67,108,146,43,91,231,230,120,113,226,247,105,63,52,241,238,242,124,46,156,95,78,96,70,46,63,116,143,227,116,123,111,1,44,19,3,236,51,207,216,205,26,154,22,165,39,167,199,200,208,101,36,100,43,57,202,242,20,99,56,28,157,124,35,113,29,160,27,211,204,210,124,113,46,106,43,204,96,62,77,227,137,116,73,41,72,36,203,142,235,64,240,48,49,64,42,41,74,214,212,207,183,42,184,210,169,211,140,170,176,104,105,69,193,122,168,50,123,187,89,96,90,66,65,107,179,89,180,119,101,120,68,63,104,234,93,227,16,15,85,209,129,49,15,14,86,107,55,9,120,100,121,153,145,22,178,88,179,197,6,196,89,88,96,135,138,136,138,215,172,218,115,219,41,42,81,5,195,51,57,43,61,208,171,199,41,81,38,224,53,225,24,144,110,105,52,66,118,229,117,227,34,234,66,107,69,10,109,151,219,48,235,183,62,191,142,129,126,116,111,143,7,163,246,118,117,50,223,222,52,94,19,141,222,221,65,196,3,197,45,220,44,156,70,139,188,122,245,139,71,162,145,153,159,149,170,150,122,188,196,206,216,92,163,144,161,164,2,167,242,141,241,0,164,37,11,72,12,144,145,160,12,38,13,70,63,71,31,226,111,157,158,154,36,101,205,203,206,165,126,209,217,98,165,97,237,220,218,237,239,241,210,214,169,140,171,32,241,125,237,179,86,178,180,85,179,181,84,180,182,83,181,194,201,182,177,137,132,184,76,183,185,61,184,186,57,185,216,212,186,192,214,187,139,34,156,218,79,237,147,123,177,45,44,4,208,201,32,98,64,129,192,213,138,235,59,219,141,242,97,97,2,141,240,75,235,229,24,228,31,25,226,230,23,229,231,22,230,232,26,231,233,112,232,244,189,243,189,221,190,222,28,221,223,27,222,224,29,223,225,30,224,113,247,225,99,60,240,213,147,215,60,20,166,192,187,213,243,112,244,244,233,245,245,128,188,188,114,174,134,131,220,174,217,236,236,198,134,215,177,58,156,143,124,25,110,7,31,228,25,264,356,368,0,11,267,451,452,349,267,302,269,350,357,277,350,452,357,299,333,297,396,175,377,381,384,382,280,347,330,269,303,270,151,9,337,344,278,360,424,418,431,270,304,409,272,310,407,322,270,410,449,450,347,432,422,434,18,313,17,291,306,375,259,387,260,424,335,418,434,364,416,391,423,327,301,251,298,275,281,4,254,373,253,375,307,321,280,425,411,200,421,18,335,321,406,321,320,405,314,315,17,423,426,266,396,377,369,270,322,269,413,417,464,385,386,258,248,456,419,298,284,333,168,417,8,448,346,261,417,413,285,326,327,328,277,355,329,309,392,438,381,382,256,279,429,360,365,364,379,355,277,437,282,443,283,281,275,363,395,431,369,299,297,337,335,273,321,348,450,349,359,446,467,283,293,282,250,458,462,300,276,383,292,308,325,283,276,293,264,372,447,346,352,340,354,274,19,363,456,281,426,436,425,380,381,252,267,269,393,421,200,428,371,266,329,432,287,422,290,250,328,385,258,384,446,265,342,386,387,257,422,424,430,445,342,276,422,273,424,306,292,307,352,366,345,268,271,302,358,423,371,327,294,460,331,279,294,303,271,304,436,432,427,304,272,408,395,394,431,378,395,400,296,334,299,6,351,168,376,352,411,307,325,320,285,295,336,320,319,404,329,330,349,334,293,333,366,323,447,316,15,315,331,358,279,317,14,316,8,285,9,277,329,350,253,374,252,319,318,403,351,6,419,324,318,325,397,367,365,288,435,397,278,344,439,310,272,311,248,195,281,375,273,291,175,396,199,312,311,268,276,283,445,390,373,339,295,282,296,448,449,346,356,264,454,337,336,299,337,338,151,294,278,455,308,292,415,429,358,355,265,340,372,388,390,466,352,346,280,295,442,282,354,19,370,285,441,295,195,248,197,457,440,274,301,300,368,417,351,465,251,301,389,385,380,386,394,395,379,399,412,419,410,436,322,387,373,388,326,2,393,354,370,461,393,164,267,268,302,12,386,374,387,312,268,13,298,293,301,265,446,340,380,385,381,280,330,425,322,426,391,420,429,437,393,391,326,344,440,438,458,459,461,364,434,394,428,396,262,274,354,457,317,316,402,316,315,403,315,314,404,314,313,405,313,421,406,323,366,361,292,306,407,306,291,408,291,287,409,287,432,410,427,434,411,372,264,383,459,309,457,366,352,401,1,274,4,418,421,262,331,294,358,435,433,367,392,289,439,328,462,326,94,2,370,289,305,455,339,254,448,359,255,446,254,253,449,253,252,450,252,256,451,256,341,452,414,413,463,286,441,414,286,258,441,258,257,442,257,259,443,259,260,444,260,467,445,309,459,250,305,289,290,305,290,460,401,376,435,309,250,392,376,411,433,453,341,464,357,453,465,343,357,412,437,343,399,344,360,440,420,437,456,360,420,363,361,401,288,265,372,353,390,339,249,339,448,255]});var ft=y(te=>{const Z=require("@tensorflow/tfjs"),an=tt(),mt=ye(),cn=dt(),dn=ht(),ln=ut().default;class pt{constructor(e,t,n,o){this.pipeline=new cn.Pipeline(e,t,n,o),o&&(this.config=o)}async estimateFaces(e,t){t&&(this.config=t);const n=e instanceof Z.Tensor?e:Z.browser.fromPixels(e),o=n.toFloat(),i=o.expandDims(0);n.dispose(),o.dispose();const s=await this.pipeline.predict(i,t);Z.dispose(i);const r=[];for(const a of s||[]){if(a.isDisposedInternal)continue;const c=a.confidence.arraySync();if(c>=this.config.detector.minConfidence){const d=a.coords?a.coords.arraySync():null,u={};if(d&&d.length>0)for(const l in mt.MESH_ANNOTATIONS)(this.config.iris.enabled||l.includes("Iris")===!1)&&(u[l]=mt.MESH_ANNOTATIONS[l].map(h=>d[h]));r.push({confidence:c||0,box:a.box?[a.box.startPoint[0],a.box.startPoint[1],a.box.endPoint[0]-a.box.startPoint[0],a.box.endPoint[1]-a.box.startPoint[1]]:0,mesh:d,annotations:u,image:a.image?Z.clone(a.image):null})}a.confidence&&a.confidence.dispose(),a.coords&&a.coords.dispose(),a.image&&a.image.dispose()}return r}}async function hn(e){const t=await Promise.all([an.load(e),Z.loadGraphModel(e.mesh.modelPath,{fromTFHub:e.mesh.modelPath.includes("tfhub.dev")}),Z.loadGraphModel(e.iris.modelPath,{fromTFHub:e.iris.modelPath.includes("tfhub.dev")})]),n=new pt(t[0],t[1],t[2],e);return n}te.load=hn;te.MediaPipeFaceMesh=pt;te.uv_coords=dn;te.triangulation=ln});var bt=y(de=>{const B=require("@tensorflow/tfjs"),q={};let gt={age:0,gender:""},le=0;async function un(e,t){const n=B.browser.fromPixels(e),o=B.image.resizeBilinear(n,[t,t]),i=B.cast(B.expandDims(o,0),"float32");return i}async function mn(e){return q.age||(q.age=await B.loadGraphModel(e.face.age.modelPath)),q.age}async function pn(e){return q.gender||(q.gender=await B.loadGraphModel(e.face.gender.modelPath)),q.gender}async function fn(e,t){if(le>t.face.age.skipFrames?le=0:le+=1,le===0)return gt;let n;if(e instanceof B.Tensor){const i=B.image.resizeBilinear(e,[t.face.age.inputSize,t.face.age.inputSize],!1);n=B.mul(i,[255]),B.dispose(i)}else n=await un(e,t.face.age.inputSize);const o={};if(t.face.age.enabled){const i=await q.age.predict(n),s=await i.data();o.age=Math.trunc(10*s[0])/10,B.dispose(i)}if(t.face.gender.enabled){const i=await q.gender.predict(n),s=await i.data(),r=Math.trunc(Math.abs(1.9*100*(s[0]-.5)))/100;r>t.face.gender.minConfidence&&(o.gender=s[0]<=.5?"female":"male",o.confidence=r),B.dispose(i)}return B.dispose(n),gt=o,o}de.predict=fn;de.loadAge=mn;de.loadGender=pn});var wt=y(Be=>{const I=require("@tensorflow/tfjs"),gn=["angry","discust","fear","happy","sad","surpise","neutral"],he={};let yt=[],Te=0;const xt=1.5;function bn(e,t){const n=I.tidy(()=>{const o=I.browser.fromPixels(e,1),i=I.image.resizeBilinear(o,[t,t]),s=I.cast(I.expandDims(i,0),"float32");return s});return n}async function yn(e){return he.emotion||(he.emotion=await I.loadGraphModel(e.face.emotion.modelPath)),he.emotion}async function xn(e,t){if(Te+=1,Te>=t.face.emotion.skipFrames)return Te=0,yt;const n=I.tidy(()=>{if(e instanceof I.Tensor){const i=I.image.resizeBilinear(e,[t.face.emotion.inputSize,t.face.emotion.inputSize],!1),[s,r,a]=I.split(i,3,3);if(t.face.emotion.useGrayscale){const c=I.mul(s,[.2989]),d=I.mul(r,[.587]),u=I.mul(a,[.114]),l=I.addN([c,d,u]);return l}return r}return bn(e,t.face.emotion.inputSize)}),o=[];if(t.face.emotion.enabled){const i=await he.emotion.predict(n),s=await i.data();for(let r=0;r<s.length;r++)xt*s[r]>t.face.emotion.minConfidence&&o.push({score:Math.min(.99,Math.trunc(100*xt*s[r])/100),emotion:gn[r]});o.sort((r,a)=>a.score-r.score),I.dispose(i)}return I.dispose(n),yt=o,o}Be.predict=xn;Be.load=yn});var Et=y(Pt=>{const Mt=require("@tensorflow/tfjs");class wn{constructor(e,t){this.model=e,this.outputStride=t;const n=this.model.inputs[0].shape;Mt.util.assert(n[1]===-1&&n[2]===-1,()=>`Input shape [${n[1]}, ${n[2]}] must both be equal to or -1`)}predict(e){return Mt.tidy(()=>{const t=this.preprocessInput(e.toFloat()),n=t.expandDims(0),o=this.model.predict(n),i=o.map(r=>r.squeeze([0])),s=this.nameOutputResults(i);return{heatmapScores:s.heatmap.sigmoid(),offsets:s.offsets,displacementFwd:s.displacementFwd,displacementBwd:s.displacementBwd}})}dispose(){this.model.dispose()}}Pt.BaseModel=wn});var ke=y(It=>{const St=require("@tensorflow/tfjs"),Pn=Et();class Mn extends Pn.BaseModel{preprocessInput(e){return St.tidy(()=>St.div(e,127.5).sub(1))}nameOutputResults(e){const[t,n,o,i]=e;return{offsets:t,heatmap:n,displacementFwd:o,displacementBwd:i}}}It.MobileNet=Mn});var Tt=y(Bt=>{function _e(e){return Math.floor(e/2)}class En{constructor(e,t){this.priorityQueue=new Array(e),this.numberOfElements=-1,this.getElementValue=t}enqueue(e){this.priorityQueue[++this.numberOfElements]=e,this.swim(this.numberOfElements)}dequeue(){const e=this.priorityQueue[0];return this.exchange(0,this.numberOfElements--),this.sink(0),this.priorityQueue[this.numberOfElements+1]=null,e}empty(){return this.numberOfElements===-1}size(){return this.numberOfElements+1}all(){return this.priorityQueue.slice(0,this.numberOfElements+1)}max(){return this.priorityQueue[0]}swim(e){for(;e>0&&this.less(_e(e),e);)this.exchange(e,_e(e)),e=_e(e)}sink(e){for(;2*e<=this.numberOfElements;){let t=2*e;if(t<this.numberOfElements&&this.less(t,t+1)&&t++,!this.less(e,t))break;this.exchange(e,t),e=t}}getValueAt(e){return this.getElementValue(this.priorityQueue[e])}less(e,t){return this.getValueAt(e)<this.getValueAt(t)}exchange(e,t){const n=this.priorityQueue[e];this.priorityQueue[e]=this.priorityQueue[t],this.priorityQueue[t]=n}}Bt.MaxHeap=En});var _t=y(kt=>{const In=Tt();function Sn(e,t,n,o,i,s){const[r,a]=s.shape;let c=!0;const d=Math.max(n-i,0),u=Math.min(n+i+1,r);for(let l=d;l<u;++l){const h=Math.max(o-i,0),m=Math.min(o+i+1,a);for(let p=h;p<m;++p)if(s.get(l,p,e)>t){c=!1;break}if(!c)break}return c}function Bn(e,t,n){const[o,i,s]=n.shape,r=new In.MaxHeap(o*i*s,({score:a})=>a);for(let a=0;a<o;++a)for(let c=0;c<i;++c)for(let d=0;d<s;++d){const u=n.get(a,c,d);if(u<e)continue;Sn(d,u,a,c,t,n)&&r.enqueue({score:u,part:{heatmapY:a,heatmapX:c,id:d}})}return r}kt.buildPartWithScoreQueue=Bn});var ne=y(z=>{z.partNames=["nose","leftEye","rightEye","leftEar","rightEar","leftShoulder","rightShoulder","leftElbow","rightElbow","leftWrist","rightWrist","leftHip","rightHip","leftKnee","rightKnee","leftAnkle","rightAnkle"];z.NUM_KEYPOINTS=z.partNames.length;z.partIds=z.partNames.reduce((e,t,n)=>(e[t]=n,e),{});const Tn=[["leftHip","leftShoulder"],["leftElbow","leftShoulder"],["leftElbow","leftWrist"],["leftHip","leftKnee"],["leftKnee","leftAnkle"],["rightHip","rightShoulder"],["rightElbow","rightShoulder"],["rightElbow","rightWrist"],["rightHip","rightKnee"],["rightKnee","rightAnkle"],["leftShoulder","rightShoulder"],["leftHip","rightHip"]];z.poseChain=[["nose","leftEye"],["leftEye","leftEar"],["nose","rightEye"],["rightEye","rightEar"],["nose","leftShoulder"],["leftShoulder","leftElbow"],["leftElbow","leftWrist"],["leftShoulder","leftHip"],["leftHip","leftKnee"],["leftKnee","leftAnkle"],["nose","rightShoulder"],["rightShoulder","rightElbow"],["rightElbow","rightWrist"],["rightShoulder","rightHip"],["rightHip","rightKnee"],["rightKnee","rightAnkle"]];z.connectedPartIndices=Tn.map(([e,t])=>[z.partIds[e],z.partIds[t]]);z.partChannels=["left_face","right_face","right_upper_leg_front","right_lower_leg_back","right_upper_leg_back","left_lower_leg_front","left_upper_leg_front","left_upper_leg_back","left_lower_leg_back","right_feet","right_lower_leg_front","left_feet","torso_front","torso_back","right_upper_arm_front","right_upper_arm_back","right_lower_arm_back","left_lower_arm_front","left_upper_arm_front","left_upper_arm_back","left_lower_arm_back","right_hand","right_lower_arm_front","left_hand"]});var Ne=y(j=>{const kn=ne();function zt(e,t,n,o){return{y:o.get(e,t,n),x:o.get(e,t,n+kn.NUM_KEYPOINTS)}}j.getOffsetPoint=zt;function _n(e,t,n){const{heatmapY:o,heatmapX:i,id:s}=e,{y:r,x:a}=zt(o,i,s,n);return{x:e.heatmapX*t+a,y:e.heatmapY*t+r}}j.getImageCoords=_n;function zn(e,t){const n=new Array(t);for(let o=0;o<t;o++)n[o]=e;return n}j.fillArray=zn;function ze(e,t,n){return e<t?t:e>n?n:e}j.clamp=ze;function Nn(e,t,n,o){const i=n-e,s=o-t;return i*i+s*s}j.squaredDistance=Nn;function An(e,t){return{x:e.x+t.x,y:e.y+t.y}}j.addVectors=An;function Rn(e,t,n){return{y:ze(e.y,t,n),x:ze(e.x,t,n)}}j.clampVector=Rn});var vt=y(Nt=>{const oe=ne(),$=Ne(),At=oe.poseChain.map(([e,t])=>[oe.partIds[e],oe.partIds[t]]),Ae=At.map(([,e])=>e),Rt=At.map(([e])=>e);function On(e,t,n){const o=n.shape[2]/2;return{y:n.get(t.y,t.x,e),x:n.get(t.y,t.x,o+e)}}function Re(e,t,n,o){return{y:$.clamp(Math.round(e.y/t),0,n-1),x:$.clamp(Math.round(e.x/t),0,o-1)}}function Ot(e,t,n,o,i,s,r,a=2){const[c,d]=o.shape,u=Re(t.position,s,c,d),l=On(e,u,r),h=$.addVectors(t.position,l);let m=h;for(let x=0;x<a;x++){const M=Re(m,s,c,d),w=$.getOffsetPoint(M.y,M.x,n,i);m=$.addVectors({x:M.x*s,y:M.y*s},{x:w.x,y:w.y})}const p=Re(m,s,c,d),P=o.get(p.y,p.x,n);return{position:m,part:oe.partNames[n],score:P}}function vn(e,t,n,o,i,s){const r=t.shape[2],a=Ae.length,c=new Array(r),{part:d,score:u}=e,l=$.getImageCoords(d,o,n);c[d.id]={score:u,part:oe.partNames[d.id],position:l};for(let h=a-1;h>=0;--h){const m=Ae[h],p=Rt[h];c[m]&&!c[p]&&(c[p]=Ot(h,c[m],p,t,n,o,s))}for(let h=0;h<a;++h){const m=Rt[h],p=Ae[h];c[m]&&!c[p]&&(c[p]=Ot(h,c[m],p,t,n,o,i))}return c}Nt.decodePose=vn});var Oe=y(Dt=>{const Dn=_t(),Cn=vt(),Ct=Ne();function Ft(e,t,{x:n,y:o},i){return e.some(({keypoints:s})=>{const r=s[i].position;return Ct.squaredDistance(o,n,r.y,r.x)<=t})}function Fn(e,t,n){const o=n.reduce((i,{position:s,score:r},a)=>(Ft(e,t,s,a)||(i+=r),i),0);return o/n.length}const Ln=1;function Hn(e,t,n,o,i,s,r=.5,a=20){const c=[],d=Dn.buildPartWithScoreQueue(r,Ln,e),u=a*a;for(;c.length<s&&!d.empty();){const l=d.dequeue(),h=Ct.getImageCoords(l.part,i,t);if(Ft(c,u,h,l.part.id))continue;const m=Cn.decodePose(l,e,t,i,n,o),p=Fn(c,u,m);c.push({keypoints:m,score:p})}return c}Dt.decodeMultiplePoses=Hn});var De=y(T=>{const J=require("@tensorflow/tfjs"),qn=ne();function jn(e,t,n){return e<n||t<n}function Un(e,t){return qn.connectedPartIndices.reduce((n,[o,i])=>(jn(e[o].score,e[i].score,t)||n.push([e[o],e[i]]),n),[])}T.getAdjacentKeyPoints=Un;const{NEGATIVE_INFINITY:Lt,POSITIVE_INFINITY:Ht}=Number;function qt(e){return e.reduce(({maxX:t,maxY:n,minX:o,minY:i},{position:{x:s,y:r}})=>({maxX:Math.max(t,s),maxY:Math.max(n,r),minX:Math.min(o,s),minY:Math.min(i,r)}),{maxX:Lt,maxY:Lt,minX:Ht,minY:Ht})}T.getBoundingBox=qt;function Wn(e){const{minX:t,minY:n,maxX:o,maxY:i}=qt(e);return[{x:t,y:n},{x:o,y:n},{x:o,y:i},{x:t,y:i}]}T.getBoundingBoxPoints=Wn;async function Kn(e){return Promise.all(e.map(t=>t.buffer()))}T.toTensorBuffers3D=Kn;function jt(e,t,n,o=0,i=0){return{score:e.score,keypoints:e.keypoints.map(({score:s,part:r,position:a})=>({score:s,part:r,position:{x:a.x*n+i,y:a.y*t+o}}))}}T.scalePose=jt;function Ut(e,t,n,o=0,i=0){return n===1&&t===1&&o===0&&i===0?e:e.map(s=>jt(s,t,n,o,i))}T.scalePoses=Ut;function Wt(e){return e instanceof J.Tensor?[e.shape[0],e.shape[1]]:[e.height,e.width]}T.getInputTensorDimensions=Wt;function ve(e){return e instanceof J.Tensor?e:J.browser.fromPixels(e)}T.toInputTensor=ve;function Yn(e,t,n){return J.tidy(()=>{const o=ve(e);return o.resizeBilinear([t,n])})}T.toResizedInputTensor=Yn;function Xn(e,[t,n]){const[o,i]=Wt(e),s=n/t,r=i/o;let[a,c,d,u]=[0,0,0,0];r<s?(a=0,c=0,d=Math.round(.5*(s*o-i)),u=Math.round(.5*(s*o-i))):(a=Math.round(.5*(1/s*i-o)),c=Math.round(.5*(1/s*i-o)),d=0,u=0);const l=J.tidy(()=>{let h=ve(e);return h=J.pad3d(h,[[a,c],[d,u],[0,0]]),h.resizeBilinear([t,n])});return{resized:l,padding:{top:a,left:d,right:u,bottom:c}}}T.padAndResizeTo=Xn;function Gn(e,[t,n],[o,i],s){const r=(t+s.top+s.bottom)/o,a=(n+s.left+s.right)/i,c=Ut(e,r,a,-s.top,-s.left);return c}T.scaleAndFlipPoses=Gn});var Yt=y(Ce=>{const Vn=require("@tensorflow/tfjs"),Qn=ke(),Zn=Oe(),ue=De();class Kt{constructor(e){this.baseModel=e}async estimatePoses(e,t){const n=t.outputStride,[o,i]=ue.getInputTensorDimensions(e),{resized:s,padding:r}=ue.padAndResizeTo(e,[t.inputResolution,t.inputResolution]),{heatmapScores:a,offsets:c,displacementFwd:d,displacementBwd:u}=this.baseModel.predict(s),l=await ue.toTensorBuffers3D([a,c,d,u]),h=l[0],m=l[1],p=l[2],P=l[3],x=await Zn.decodeMultiplePoses(h,m,p,P,n,t.maxDetections,t.scoreThreshold,t.nmsRadius),M=ue.scaleAndFlipPoses(x,[o,i],[t.inputResolution,t.inputResolution],r);return a.dispose(),c.dispose(),d.dispose(),u.dispose(),s.dispose(),M}dispose(){this.baseModel.dispose()}}Ce.PoseNet=Kt;async function $n(e){const t=await Vn.loadGraphModel(e.modelPath),n=new Qn.MobileNet(t,e.outputStride);return new Kt(n)}async function Jn(e){return $n(e)}Ce.load=Jn});var Gt=y(S=>{const eo=ke(),Xt=Yt(),to=Oe(),me=ne(),se=De();S.load=Xt.load;S.PoseNet=Xt.PoseNet;S.MobileNet=eo.MobileNet;S.decodeMultiplePoses=to.decodeMultiplePoses;S.partChannels=me.partChannels;S.partIds=me.partIds;S.partNames=me.partNames;S.poseChain=me.poseChain;S.getAdjacentKeyPoints=se.getAdjacentKeyPoints;S.getBoundingBox=se.getBoundingBox;S.getBoundingBoxPoints=se.getBoundingBoxPoints;S.scaleAndFlipPoses=se.scaleAndFlipPoses;S.scalePose=se.scalePose});var He=y(U=>{const no=require("@tensorflow/tfjs");function Fe(e){return[Math.abs(e.endPoint[0]-e.startPoint[0]),Math.abs(e.endPoint[1]-e.startPoint[1])]}U.getBoxSize=Fe;function Le(e){return[e.startPoint[0]+(e.endPoint[0]-e.startPoint[0])/2,e.startPoint[1]+(e.endPoint[1]-e.startPoint[1])/2]}U.getBoxCenter=Le;function oo(e,t,n){const o=t.shape[1],i=t.shape[2],s=[[e.startPoint[1]/o,e.startPoint[0]/i,e.endPoint[1]/o,e.endPoint[0]/i]];return no.image.cropAndResize(t,s,[0],n)}U.cutBoxFromImageAndResize=oo;function so(e,t){const n=[e.startPoint[0]*t[0],e.startPoint[1]*t[1]],o=[e.endPoint[0]*t[0],e.endPoint[1]*t[1]],i=e.palmLandmarks.map(s=>{const r=[s[0]*t[0],s[1]*t[1]];return r});return{startPoint:n,endPoint:o,palmLandmarks:i}}U.scaleBoxCoordinates=so;function io(e,t=1.5){const n=Le(e),o=Fe(e),i=[t*o[0]/2,t*o[1]/2],s=[n[0]-i[0],n[1]-i[1]],r=[n[0]+i[0],n[1]+i[1]];return{startPoint:s,endPoint:r,palmLandmarks:e.palmLandmarks}}U.enlargeBox=io;function ro(e){const t=Le(e),n=Fe(e),o=Math.max(...n),i=o/2,s=[t[0]-i,t[1]-i],r=[t[0]+i,t[1]+i];return{startPoint:s,endPoint:r,palmLandmarks:e.palmLandmarks}}U.squarifyBox=ro;function ao(e,t){const n=[e.endPoint[0]-e.startPoint[0],e.endPoint[1]-e.startPoint[1]],o=[n[0]*t[0],n[1]*t[1]],i=[e.startPoint[0]+o[0],e.startPoint[1]+o[1]],s=[e.endPoint[0]+o[0],e.endPoint[1]+o[1]];return{startPoint:i,endPoint:s,palmLandmarks:e.palmLandmarks}}U.shiftBox=ao});var Qt=y(Vt=>{const b=require("@tensorflow/tfjs"),co=He();class lo{constructor(e,t,n){this.model=e,this.width=n.inputSize,this.height=n.inputSize,this.anchors=t.map(o=>[o.x_center,o.y_center]),this.anchorsTensor=b.tensor2d(this.anchors),this.inputSizeTensor=b.tensor1d([n.inputSize,n.inputSize]),this.doubleInputSizeTensor=b.tensor1d([n.inputSize*2,n.inputSize*2])}normalizeBoxes(e){return b.tidy(()=>{const t=b.slice(e,[0,0],[-1,2]),n=b.slice(e,[0,2],[-1,2]),o=b.add(b.div(t,this.inputSizeTensor),this.anchorsTensor),i=b.div(n,this.doubleInputSizeTensor),s=b.mul(b.sub(o,i),this.inputSizeTensor),r=b.mul(b.add(o,i),this.inputSizeTensor);return b.concat2d([s,r],1)})}normalizeLandmarks(e,t){return b.tidy(()=>{const n=b.add(b.div(e.reshape([-1,7,2]),this.inputSizeTensor),this.anchors[t]);return b.mul(n,this.inputSizeTensor)})}async getBoundingBoxes(e){const t=b.tidy(()=>b.mul(b.sub(e,.5),2)),n=this.model.predict(t),o=n.squeeze(),i=b.tidy(()=>b.sigmoid(b.slice(o,[0,0],[-1,1])).squeeze()),s=b.slice(o,[0,1],[-1,4]),r=this.normalizeBoxes(s),a=await b.image.nonMaxSuppressionAsync(r,i,this.maxHands,this.iouThreshold,this.scoreThreshold),c=await a.array(),d=[t,n,a,o,r,s,i],u=b.tidy(()=>{const l=[];for(const h in c){const m=c[h],p=b.slice(r,[m,0],[1,-1]),P=b.slice(o,[m,5],[1,14]),x=b.tidy(()=>this.normalizeLandmarks(P,m).reshape([-1,2]));l.push({boxes:p,palmLandmarks:x})}return l});return d.forEach(l=>l.dispose()),u}async estimateHandBounds(e,t){const n=e.shape[1],o=e.shape[2];this.iouThreshold=t.iouThreshold,this.scoreThreshold=t.scoreThreshold,this.maxHands=t.maxHands;const i=b.tidy(()=>e.resizeBilinear([this.width,this.height]).div(255)),s=await this.getBoundingBoxes(i);if(i.dispose(),!s||s.length===0)return null;const r=[];for(const a in s){const c=s[a],d=await c.boxes.array(),u=d[0].slice(0,2),l=d[0].slice(2,4),h=await c.palmLandmarks.array();c.boxes.dispose(),c.palmLandmarks.dispose(),r.push(co.scaleBoxCoordinates({startPoint:u,endPoint:l,palmLandmarks:h},[o/this.width,n/this.height]))}return r}}Vt.HandDetector=lo});var $t=y(Zt=>{Zt.MESH_ANNOTATIONS={thumb:[1,2,3,4],indexFinger:[5,6,7,8],middleFinger:[9,10,11,12],ringFinger:[13,14,15,16],pinky:[17,18,19,20],palmBase:[0]}});var o0=y(W=>{function Jt(e){return e-2*Math.PI*Math.floor((e+Math.PI)/(2*Math.PI))}W.normalizeRadians=Jt;function ho(e,t){const n=Math.PI/2-Math.atan2(-(t[1]-e[1]),t[0]-e[0]);return Jt(n)}W.computeRotation=ho;const e0=(e,t)=>[[1,0,e],[0,1,t],[0,0,1]];function ee(e,t){let n=0;for(let o=0;o<e.length;o++)n+=e[o]*t[o];return n}W.dot=ee;function t0(e,t){const n=[];for(let o=0;o<e.length;o++)n.push(e[o][t]);return n}W.getColumnFrom2DArr=t0;function n0(e,t){const n=[],o=e.length;for(let i=0;i<o;i++){n.push([]);for(let s=0;s<o;s++)n[i].push(ee(e[i],t0(t,s)))}return n}function uo(e,t){const n=Math.cos(e),o=Math.sin(e),i=[[n,-o,0],[o,n,0],[0,0,1]],s=e0(t[0],t[1]),r=n0(s,i),a=e0(-t[0],-t[1]);return n0(r,a)}W.buildRotationMatrix=uo;function mo(e){const t=[[e[0][0],e[1][0]],[e[0][1],e[1][1]]],n=[e[0][2],e[1][2]],o=[-ee(t[0],n),-ee(t[1],n)];return[t[0].concat(o[0]),t[1].concat(o[1]),[0,0,1]]}W.invertTransformMatrix=mo;function po(e,t){return[ee(e,t[0]),ee(e,t[1])]}W.rotatePoint=po});var a0=y(s0=>{const i0=require("@tensorflow/tfjs"),O=He(),K=o0(),fo=.8,go=[0,-.4],bo=[0,-.1],yo=1.65,r0=[0,5,9,13,17,1,2],xo=0,wo=2;class Po{constructor(e,t,n){this.regionsOfInterest=[],this.runsWithoutHandDetector=0,this.boundingBoxDetector=e,this.meshDetector=t,this.meshWidth=n.inputSize,this.meshHeight=n.inputSize,this.enlargeFactor=n.enlargeFactor}getBoxForPalmLandmarks(e,t){const n=e.map(i=>{const s=[...i,1];return K.rotatePoint(s,t)}),o=this.calculateLandmarksBoundingBox(n);return O.enlargeBox(O.squarifyBox(O.shiftBox(o,go)),this.enlargeFactor)}getBoxForHandLandmarks(e){const t=this.calculateLandmarksBoundingBox(e),n=O.enlargeBox(O.squarifyBox(O.shiftBox(t,bo)),yo),o=[];for(let i=0;i<r0.length;i++)o.push(e[r0[i]].slice(0,2));return n.palmLandmarks=o,n}transformRawCoords(e,t,n,o){const i=O.getBoxSize(t),s=[i[0]/this.meshWidth,i[1]/this.meshHeight],r=e.map(h=>[s[0]*(h[0]-this.meshWidth/2),s[1]*(h[1]-this.meshHeight/2),h[2]]),a=K.buildRotationMatrix(n,[0,0]),c=r.map(h=>{const m=K.rotatePoint(h,a);return[...m,h[2]]}),d=K.invertTransformMatrix(o),u=[...O.getBoxCenter(t),1],l=[K.dot(u,d[0]),K.dot(u,d[1])];return c.map(h=>[h[0]+l[0],h[1]+l[1],h[2]])}async estimateHands(e,t){this.maxContinuousChecks=t.skipFrames,this.detectionConfidence=t.minConfidence,this.maxHands=t.maxHands;const n=this.shouldUpdateRegionsOfInterest();if(n===!0){const i=await this.boundingBoxDetector.estimateHandBounds(e,t);this.regionsOfInterest=[];for(const s in i)this.updateRegionsOfInterest(i[s],!0,s);this.runsWithoutHandDetector=0}else this.runsWithoutHandDetector++;const o=[];if(!this.regionsOfInterest)return o;for(const i in this.regionsOfInterest){const s=this.regionsOfInterest[i][0];if(!s)return o;const r=K.computeRotation(s.palmLandmarks[xo],s.palmLandmarks[wo]),a=O.getBoxCenter(s),c=[a[0]/e.shape[2],a[1]/e.shape[1]],d=i0.image.rotateWithOffset(e,r,0,c),u=K.buildRotationMatrix(-r,a),l=n?this.getBoxForPalmLandmarks(s.palmLandmarks,u):s,h=O.cutBoxFromImageAndResize(l,d,[this.meshWidth,this.meshHeight]),m=h.div(255);h.dispose(),d.dispose();const p=this.meshDetector.predict(m),[P,x]=p;m.dispose();const M=P.dataSync()[0];if(P.dispose(),M<t.minConfidence)return x.dispose(),this.regionsOfInterest[i]=[],o;const w=i0.reshape(x,[-1,3]),A=await w.array();x.dispose(),w.dispose();const C=this.transformRawCoords(A,l,r,u),F=this.getBoxForHandLandmarks(C);this.updateRegionsOfInterest(F,!1,i);const fe={landmarks:C,confidence:M,box:{topLeft:F.startPoint,bottomRight:F.endPoint}};o.push(fe)}return o}calculateLandmarksBoundingBox(e){const t=e.map(s=>s[0]),n=e.map(s=>s[1]),o=[Math.min(...t),Math.min(...n)],i=[Math.max(...t),Math.max(...n)];return{startPoint:o,endPoint:i}}updateRegionsOfInterest(e,t,n){if(t)this.regionsOfInterest[n]=[e];else{const o=this.regionsOfInterest[n][0];let i=0;if(o!=null&&o.startPoint!=null){const[s,r]=e.startPoint,[a,c]=e.endPoint,[d,u]=o.startPoint,[l,h]=o.endPoint,m=Math.max(s,d),p=Math.max(r,u),P=Math.min(a,l),x=Math.min(c,h),M=(P-m)*(x-p),w=(a-s)*(c-r),A=(l-d)*(h-r);i=M/(w+A-M)}this.regionsOfInterest[n][0]=i>fo?o:e}}shouldUpdateRegionsOfInterest(){return!this.regionsOfInterest||this.regionsOfInterest.length===0||this.runsWithoutHandDetector>=this.maxContinuousChecks}}s0.HandPipeline=Po});var l0=y(qe=>{const V=require("@tensorflow/tfjs"),Mo=Qt(),c0=$t(),Eo=a0();class d0{constructor(e){this.pipeline=e}async estimateHands(e,t){this.maxContinuousChecks=t.skipFrames,this.detectionConfidence=t.minConfidence,this.maxHands=t.maxHands;const n=V.tidy(()=>(e instanceof V.Tensor||(e=V.browser.fromPixels(e)),e.toFloat().expandDims(0))),o=await this.pipeline.estimateHands(n,t);n.dispose();const i=[];if(!o)return i;for(const s of o){if(!s)return[];const r={};for(const a of Object.keys(c0.MESH_ANNOTATIONS))r[a]=c0.MESH_ANNOTATIONS[a].map(c=>s.landmarks[c]);i.push({confidence:s.confidence||0,box:s.box?[s.box.topLeft[0],s.box.topLeft[1],s.box.bottomRight[0]-s.box.topLeft[0],s.box.bottomRight[1]-s.box.topLeft[1]]:0,landmarks:s.landmarks,annotations:r})}return i}}qe.HandPose=d0;async function Io(e){if(V.env().features.IS_NODE){const t=require("fs"),n=await t.readFileSync(e.replace("file://",""));return JSON.parse(n)}return V.util.fetch(e).then(t=>t.json())}async function So(e){const[t,n,o]=await Promise.all([Io(e.detector.anchors),V.loadGraphModel(e.detector.modelPath,{fromTFHub:e.detector.modelPath.includes("tfhub.dev")}),V.loadGraphModel(e.skeleton.modelPath,{fromTFHub:e.skeleton.modelPath.includes("tfhub.dev")})]),i=new Mo.HandDetector(n,t,e),s=new Eo.HandPipeline(i,o,e),r=new d0(s);return r}qe.load=So});var h0=y(Bo=>{Qe(Bo,{default:()=>To});var To={backend:"webgl",console:!0,scoped:!1,face:{enabled:!0,detector:{modelPath:"../models/blazeface/back/model.json",inputSize:256,maxFaces:10,skipFrames:10,minConfidence:.5,iouThreshold:.3,scoreThreshold:.7},mesh:{enabled:!0,modelPath:"../models/facemesh/model.json",inputSize:192},iris:{enabled:!0,modelPath:"../models/iris/model.json",enlargeFactor:2.3,inputSize:64},age:{enabled:!0,modelPath:"../models/ssrnet-age/imdb/model.json",inputSize:64,skipFrames:10},gender:{enabled:!0,minConfidence:.8,modelPath:"../models/ssrnet-gender/imdb/model.json"},emotion:{enabled:!0,inputSize:64,minConfidence:.5,skipFrames:10,useGrayscale:!0,modelPath:"../models/emotion/model.json"}},body:{enabled:!0,modelPath:"../models/posenet/model.json",inputResolution:257,outputStride:16,maxDetections:10,scoreThreshold:.7,nmsRadius:20},hand:{enabled:!0,inputSize:256,skipFrames:10,minConfidence:.5,iouThreshold:.3,scoreThreshold:.7,enlargeFactor:1.65,maxHands:10,detector:{anchors:"../models/handdetect/anchors.json",modelPath:"../models/handdetect/model.json"},skeleton:{modelPath:"../models/handskeleton/model.json"}}}});var m0=y((cs,u0)=>{u0.exports={name:"@vladmandic/human",version:"0.3.5",description:"human: 3D Face Detection, Iris Tracking and Age & Gender Prediction",sideEffects:!1,main:"dist/human.cjs",module:"dist/human.esm.js",browser:"dist/human.esm.js",author:"Vladimir Mandic <mandic00@live.com>",bugs:{url:"https://github.com/vladmandic/human/issues"},homepage:"https://github.com/vladmandic/human#readme",license:"MIT",engines:{node:">=14.0.0"},repository:{type:"git",url:"git+https://github.com/vladmandic/human.git"},dependencies:{},peerDependencies:{},devDependencies:{"@vladmandic/pilogger":"^0.2.6",dayjs:"^1.9.3","simple-git":"^2.21.0","@tensorflow/tfjs":"^2.6.0","@tensorflow/tfjs-node":"^2.6.0",esbuild:"^0.7.15",eslint:"^7.10.0","eslint-config-airbnb-base":"^14.2.0","eslint-plugin-import":"^2.22.1","eslint-plugin-json":"^2.1.2","eslint-plugin-node":"^11.1.0","eslint-plugin-promise":"^4.2.1",rimraf:"^3.0.2"},scripts:{start:"node --trace-warnings --trace-uncaught --no-deprecation demo/node.js",lint:"eslint src/*.js demo/*.js","build-iife":"esbuild --bundle --platform=browser --sourcemap --target=esnext --format=iife --minify --external:fs --global-name=human --metafile=dist/human.json --outfile=dist/human.js src/index.js","build-esm-bundle":"esbuild --bundle --platform=browser --sourcemap --target=esnext --format=esm --minify --external:fs --metafile=dist/human.esm.json --outfile=dist/human.esm.js src/index.js","build-esm-nobundle":"esbuild --bundle --platform=browser --sourcemap --target=esnext --format=esm --minify --external:@tensorflow --external:fs --metafile=dist/human.esm-nobundle.json --outfile=dist/human.esm-nobundle.js src/index.js","build-node":"esbuild --bundle --platform=node --sourcemap --target=esnext --format=cjs --external:@tensorflow --metafile=dist/human.cjs.json --outfile=dist/human.cjs src/index.js",build:"rimraf dist/* && npm run build-iife && npm run build-esm-bundle && npm run build-esm-nobundle && npm run build-node && ls -l dist/",update:"npm update --depth 20 && npm dedupe && npm prune && npm audit",changelog:"node changelog.js"},keywords:["tensorflowjs","face-detection","face-geometry","body-tracking","hand-tracking","iris-tracking","age-estimation","emotion-detection","gender-prediction","gesture-recognition"]}});var x0=y(k=>{const Y=require("@tensorflow/tfjs"),p0=ft(),pe=bt(),f0=wt(),g0=Gt(),b0=l0(),je=h0().default,ko=m0();let f,N="idle";const E={facemesh:null,posenet:null,handpose:null,iris:null,age:null,gender:null,emotion:null},v=()=>typeof performance!="undefined"?performance.now():parseInt(Number(process.hrtime.bigint())/1e3/1e3),ie=(...e)=>{e&&f.console&&console.log(...e)};let y0=0;const _o=!1,X=(...e)=>{if(!_o)return;const t=Y.engine().state.numTensors,n=y0;y0=t;const o=t-n;o!==0&&ie(...e,o)};function Ue(...e){const t=n=>n&&typeof n=="object";return e.reduce((n,o)=>(Object.keys(o||{}).forEach(i=>{const s=n[i],r=o[i];Array.isArray(s)&&Array.isArray(r)?n[i]=s.concat(...r):t(s)&&t(r)?n[i]=Ue(s,r):n[i]=r}),n),{})}function zo(e){if(!e)return"input is not defined";const t=e.naturalWidth||e.videoWidth||e.width||e.shape&&e.shape[1]>0;if(!t||t===0)return"input is empty";if(e.readyState&&e.readyState<=2)return"input is not ready";try{Y.getBackend()}catch{return"backend not loaded"}return null}async function No(e){e&&(f=Ue(je,e)),f.face.enabled&&!E.facemesh&&(E.facemesh=await p0.load(f.face)),f.body.enabled&&!E.posenet&&(E.posenet=await g0.load(f.body)),f.hand.enabled&&!E.handpose&&(E.handpose=await b0.load(f.hand)),f.face.enabled&&f.face.age.enabled&&!E.age&&(E.age=await pe.loadAge(f)),f.face.enabled&&f.face.gender.enabled&&!E.gender&&(E.gender=await pe.loadGender(f)),f.face.enabled&&f.face.emotion.enabled&&!E.emotion&&(E.emotion=await f0.load(f))}async function Ao(e,t={}){N="config",f=Ue(je,t),N="check";const n=zo(e);return n?(ie(n,e),{error:n}):new Promise(async o=>{const i=Object.values(E).filter(u=>u).length;i===0&&ie("Human library starting"),Y.getBackend()!==f.backend&&(N="backend",ie("Human library setting backend:",f.backend),await Y.setBackend(f.backend),await Y.ready()),N="load",await No();const s={};let r;f.scoped&&Y.engine().startScope(),X("Start Detect:"),N="run:body",r=v(),X("Start PoseNet");const a=f.body.enabled?await E.posenet.estimatePoses(e,f.body):[];X("End PoseNet:"),s.body=Math.trunc(v()-r),N="run:hand",r=v(),X("Start HandPose:");const c=f.hand.enabled?await E.handpose.estimateHands(e,f.hand):[];X("End HandPose:"),s.hand=Math.trunc(v()-r);const d=[];if(f.face.enabled){N="run:face",r=v(),X("Start FaceMesh:");const u=await E.facemesh.estimateFaces(e,f.face);s.face=Math.trunc(v()-r);for(const l of u){if(!l.image||l.image.isDisposedInternal){ie("face object is disposed:",l.image);continue}N="run:agegender",r=v();const h=f.face.age.enabled||f.face.gender.enabled?await pe.predict(l.image,f):{};s.agegender=Math.trunc(v()-r),N="run:emotion",r=v();const m=f.face.emotion.enabled?await f0.predict(l.image,f):{};s.emotion=Math.trunc(v()-r),l.image.dispose(),delete l.image;const p=l.annotations.leftEyeIris&&l.annotations.rightEyeIris?Math.max(l.annotations.leftEyeIris[3][0]-l.annotations.leftEyeIris[1][0],l.annotations.rightEyeIris[3][0]-l.annotations.rightEyeIris[1][0]):0;d.push({confidence:l.confidence,box:l.box,mesh:l.mesh,annotations:l.annotations,age:h.age,gender:h.gender,agConfidence:h.confidence,emotion:m,iris:p!==0?Math.trunc(100*11.7/p)/100:0})}X("End FaceMesh:")}N="idle",f.scoped&&Y.engine().endScope(),X("End Scope:"),s.total=Object.values(s).reduce((u,l)=>u+l),o({face:d,body:a,hand:c,performance:s})})}k.detect=Ao;k.defaults=je;k.config=f;k.models=E;k.facemesh=p0;k.ssrnet=pe;k.posenet=g0;k.handpose=b0;k.tf=Y;k.version=ko.version;k.state=N});export default x0();
//# sourceMappingURL=human.esm-nobundle.js.map
